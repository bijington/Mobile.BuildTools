<?xml version="1.0" encoding="UTF-8"?>
<Project>

  <PropertyGroup>
    <IsWindows Condition=" '$(OS)' == 'Windows_NT'">true</IsWindows>
    <IsWindows Condition=" '$(IsWindows)' == '' ">false</IsWindows>
    <IsUnix Condition=" '$(OS)' == 'Unix' ">true</IsUnix>
    <IsUnix Condition=" '$(IsUnix)' == '' ">false</IsUnix>
    <AutoGenerateBindingRedirects>true</AutoGenerateBindingRedirects>
    <PowerShellExe Condition=" '$(PowerShellExe)'=='' And '$(IsWindows)' == 'true' ">powershell.exe</PowerShellExe>
    <PowerShellExe Condition=" '$(PowerShellExe)'=='' And '$(IsUnix)' == 'true' ">\usr\local\bin\powershell</PowerShellExe>
    <EnableDefaultEmbeddedResourceItems>True</EnableDefaultEmbeddedResourceItems>
    <IsAndroidProject>false</IsAndroidProject>
    <IsiOSProject>false</IsiOSProject>
    <IsUWPProject>false</IsUWPProject>
    <IsMacOSProject>false</IsMacOSProject>
    <IsTizenProject>false</IsTizenProject>
    <MobileBuildToolsTargets>$(MSBuildThisFileDirectory)Mobile.BuildTools.targets</MobileBuildToolsTargets>
    <_MobileBuildToolsParentBuildTasksDll>$([System.IO.Path]::Combine('$(MSBuildThisFileDirectory)', 'Mobile.BuildTools.dll'))</_MobileBuildToolsParentBuildTasksDll>
    <BuildToolsArtifactOutputPath Condition=" '$(BuildToolsArtifactOutputPath)' == '' ">$([System.IO.Path]::Combine('$(SolutionDir)', 'Artifacts'))</BuildToolsArtifactOutputPath>
    <BuildToolsArtifactOutputPath Condition=" '$(BUILD_ARTIFACTSTAGINGDIRECTORY)' != '' ">$([System.IO.Path]::Combine('$(BUILD_ARTIFACTSTAGINGDIRECTORY)', 'App'))</BuildToolsArtifactOutputPath>
    <IsAppCenter Condition=" '$(IsAppCenter)' == '' ">false</IsAppCenter>
    <IsAppCenter Condition=" '$(APPCENTER_BUILD_ID)' != '' ">true</IsAppCenter>
    <IsAzureDevOps Condition=" '$(IsAzureDevOps)' == '' ">false</IsAzureDevOps>
    <IsAzureDevOps Condition=" '$(BUILD_BUILDNUMBER)' != '' ">true</IsAzureDevOps>
    <IsAppVeyor Condition=" '$(IsAppVeyor)' == '' ">false</IsAppVeyor>
    <IsAppVeyor Condition=" '$(APPVEYOR_BUILD_NUMBER)' != '' ">true</IsAppVeyor>
    <IsJenkins Condition=" '$(IsJenkins)' == '' ">false</IsJenkins>
    <IsJenkins Condition=" '$(BUILD_NUMBER)' != '' And '$(TEAMCITY_VERSION)' == '' ">true</IsJenkins>
    <IsTeamCity Condition=" '$(IsTeamCity)' == '' ">false</IsTeamCity>
    <IsTeamCity Condition=" '$(BUILD_NUMBER)' != '' And '$(TEAMCITY_VERSION)' != '' ">true</IsTeamCity>
    <IsBuildHost Condition=" '$(IsBuildHost)' == '' ">false</IsBuildHost>
    <IsBuildHost Condition=" '$(IsAppCenter)' Or '$(IsAzureDevOps)' Or '$(IsAppVeyor)' Or '$(IsJenkins)' Or '$(IsTeamCity)' ">true</IsBuildHost>
  </PropertyGroup>

  <Choose>
    <When Condition=" '$(TargetFrameworkIdentifier)' == 'MonoAndroid' Or '$(TargetFrameworkIdentifier)' == 'Xamarin.Android' ">
      <PropertyGroup>
        <IsAndroidProject>true</IsAndroidProject>
        <BuildHostSecretPrefix>DroidSecret_</BuildHostSecretPrefix>
      </PropertyGroup>
    </When>
    <When Condition=" '$(TargetFrameworkIdentifier)' == 'Xamarin.iOS' ">
      <PropertyGroup>
        <IsiOSProject>true</IsiOSProject>
        <BuildHostSecretPrefix>iOSSecret_</BuildHostSecretPrefix>
      </PropertyGroup>
    </When>
    <When Condition=" '$(TargetFrameworkIdentifier)' == '.NETCore' ">
      <PropertyGroup>
        <IsUWPProject>true</IsUWPProject>
        <BuildHostSecretPrefix>UWPSecret_</BuildHostSecretPrefix>
      </PropertyGroup>
    </When>
    <When Condition=" '$(TargetFrameworkIdentifier)' == 'Xamarin.Mac' ">
      <PropertyGroup>
        <IsMacOSProject>true</IsMacOSProject>
        <BuildHostSecretPrefix>MacSecret_</BuildHostSecretPrefix>
      </PropertyGroup>
    </When>
    <When Condition=" '$(TargetFrameworkIdentifier)' == 'Tizen' ">
      <PropertyGroup>
        <IsTizenProject>true</IsTizenProject>
        <BuildHostSecretPrefix>TizenSecret_</BuildHostSecretPrefix>
      </PropertyGroup>
    </When>
    <When Condition=" '$(_SdkShortFrameworkIdentifier)' == 'monoandroid' Or '$(_SdkShortFrameworkIdentifier)' == 'xamarinandroid' Or '$(_SdkShortFrameworkIdentifier)' == 'xamarin.android' ">
      <PropertyGroup>
        <IsAndroidProject>true</IsAndroidProject>
        <BuildHostSecretPrefix>DroidSecret_</BuildHostSecretPrefix>
      </PropertyGroup>
    </When>
    <When Condition=" '$(_SdkShortFrameworkIdentifier)' == 'xamarinios' Or '$(_SdkShortFrameworkIdentifier)' == 'xamarin.ios' ">
      <PropertyGroup>
        <IsiOSProject>true</IsiOSProject>
        <BuildHostSecretPrefix>iOSSecret_</BuildHostSecretPrefix>
      </PropertyGroup>
    </When>
    <When Condition=" '$(_SdkShortFrameworkIdentifier)' == 'win' Or '$(_SdkShortFrameworkIdentifier)' == 'uap' ">
      <PropertyGroup>
        <IsUWPProject>true</IsUWPProject>
        <BuildHostSecretPrefix>UWPSecret_</BuildHostSecretPrefix>
      </PropertyGroup>
    </When>
    <When Condition=" '$(_SdkShortFrameworkIdentifier)' == 'xamarinmac' Or '$(_SdkShortFrameworkIdentifier)' == 'xamarin.mac' ">
      <PropertyGroup>
        <IsMacOSProject>true</IsMacOSProject>
        <BuildHostSecretPrefix>MacSecret_</BuildHostSecretPrefix>
      </PropertyGroup>
    </When>
    <When Condition=" '$(_SdkShortFrameworkIdentifier)' == 'tizen' ">
      <PropertyGroup>
        <IsTizenProject>true</IsTizenProject>
        <BuildHostSecretPrefix>TizenSecret_</BuildHostSecretPrefix>
      </PropertyGroup>
    </When>
    <Otherwise>
      <PropertyGroup>
        <BuildHostSecretPrefix>MBTSecret_</BuildHostSecretPrefix>
      </PropertyGroup>
    </Otherwise>
  </Choose>

  <PropertyGroup>
    <IsPlatformProject>false</IsPlatformProject>
    <IsPlatformProject Condition=" $(IsAndroidProject) ">true</IsPlatformProject>
    <IsPlatformProject Condition=" $(IsiOSProject) ">true</IsPlatformProject>
    <IsPlatformProject Condition=" $(IsUWPProject) ">true</IsPlatformProject>
    <IsPlatformProject Condition=" $(IsMacOSProject) ">true</IsPlatformProject>
    <IsPlatformProject Condition=" $(IsTizenProject) ">true</IsPlatformProject>
  </PropertyGroup>

  <PropertyGroup Condition=" '$(SolutionDir)' == '' Or '$(SolutionDir)' == '*Undefined*' ">
    <ProjectParentDir>$([System.IO.Directory]::GetParent($(MSBuildProjectDirectory)))</ProjectParentDir>
    <ProjectParentDirName>$([System.IO.Directory]::GetParent($(MSBuildProjectDirectory)).Name)</ProjectParentDirName>
    <SolutionDir>$(ProjectParentDir)</SolutionDir>
    <SolutionDir Condition=" '$(ProjectParentDirName)' == 'src' Or '$(ProjectParentDirName)' == 'source' ">$([System.IO.Directory]::GetParent($(ProjectParentDir)))</SolutionDir>
  </PropertyGroup>

  <!-- VS4Mac executes using the Mono Runtime & provides no way for us to know -->
  <PropertyGroup Condition=" '$(MSBuildRuntimeType)' == 'Mono' ">
    <IsOSX>Unknown</IsOSX>
    <IsLinux>Unknown</IsLinux>
  </PropertyGroup>

  <PropertyGroup Condition="'$(MSBuildRuntimeType)' == 'Core'">
    <IsOSX Condition="'$([System.Runtime.InteropServices.RuntimeInformation]::IsOSPlatform($([System.Runtime.InteropServices.OSPlatform]::OSX)))' == 'true'">true</IsOSX>
    <IsLinux Condition="'$([System.Runtime.InteropServices.RuntimeInformation]::IsOSPlatform($([System.Runtime.InteropServices.OSPlatform]::Linux)))' == 'true'">true</IsLinux>
    <EnableDefaultItems Condition=" '$(EnableDefaultItems)' == '' ">true</EnableDefaultItems>
    <EnableDefaultNoneItems Condition=" '$(EnableDefaultNoneItems)' == '' ">true</EnableDefaultNoneItems>
    <EnableDefaultXamlItems Condition=" '$(EnableDefaultXamlItems)' == '' ">true</EnableDefaultXamlItems>
    <EnableDefaultEmbeddedResourceItems Condition=" '$(EnableDefaultEmbeddedResourceItems)' == '' ">true</EnableDefaultEmbeddedResourceItems>
  </PropertyGroup>

  <PropertyGroup Condition=" '$(Configuration)' == 'Mock' ">
    <DefineConstants>$(DefineConstants);DEBUG</DefineConstants>
  </PropertyGroup>

  <PropertyGroup>
    <MBTSharedAppConfigDir Condition=" $(MBTSharedAppConfigDir) == '' ">$(SolutionDir)</MBTSharedAppConfigDir>
    <_SolutionConfig>$([System.IO.Path]::Combine('$(MBTSharedAppConfigDir)', 'app.config'))</_SolutionConfig>
    <_SolutionEnvironmentConfig>$([System.IO.Path]::Combine('$(MBTSharedAppConfigDir)', 'app.*.config'))</_SolutionEnvironmentConfig>
    <_ProjectConfig>app.config</_ProjectConfig>
    <_ProjectEnvironmentConfig>app.*.config</_ProjectEnvironmentConfig>
    <_UseProjectAppConfig>false</_UseProjectAppConfig>
    <_UseProjectAppConfig Condition=" Exists('$(_ProjectConfig)') ">true</_UseProjectAppConfig>
    <_UseSolutionAppConfig>false</_UseSolutionAppConfig>
    <_UseSolutionAppConfig Condition="'$(_UseProjectAppConfig)' == 'false'">Exists('$(_SolutionConfig)')</_UseSolutionAppConfig>
  </PropertyGroup>

  <ItemGroup Condition=" $(_UseProjectAppConfig) == 'true' ">
    <None Remove="app.config" />
    <None Remove="app.*.config" />
    <MobileBuildToolsConfig Include="$(_ProjectConfig)"  Visible="Exists(%(FullPath))" IsRootConfig="true" />
    <MobileBuildToolsConfig Include="$(_ProjectEnvironmentConfig)" DependentUpon="app.config" Visible="Exists(%(FullPath))" />
  </ItemGroup>

  <ItemGroup  Condition=" !$(TargetFramework.StartsWith('netstandard')) And $(_UseSolutionAppConfig) == 'true' ">
    <MobileBuildToolsConfig Include="$(_SolutionConfig)" Visible="Exists(%(FullPath))" IsRootConfig="true" />
    <MobileBuildToolsConfig Include="$(_SolutionEnvironmentConfig)" DependentUpon="app.config" Visible="Exists(%(FullPath))" />
  </ItemGroup>

</Project>